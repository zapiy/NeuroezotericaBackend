import"./global-31735648.js";function i(s,{children:n,...t}={}){let e=Object.assign(document.createElement(s),t);return n&&n.forEach(o=>e.appendChild(o)),e}function g(){$(".modal-overflow").addClass("hidden"),$(".modal-overflow .modal").remove()}function f({title:s,content:n}={}){$(".modal-overflow").removeClass("hidden"),$(".modal-overflow").append(i("div",{classList:["modal"],onclick:t=>t.stopPropagation(),children:[i("div",{id:"header",children:[i("div",{id:"side",children:[i("img",{id:"logo",src:"/static/res/logo.svg"}),i("span",{id:"title",innerText:s??"Ошибка"})]}),i("span",{id:"close",classList:["material-symbols-outlined"],innerText:"close",onclick:t=>g()})]}),i("span",{id:"content",innerText:n??"Не указано!"})]}))}$(function(){const s=document.cookie===""?{}:Object.fromEntries(document.cookie.split("; ").map(t=>t.split("=")));try{const t=new URL(window.location.href);if(t.searchParams.has("modal")){const e=JSON.parse(t.searchParams.get("modal"));t.searchParams.delete("modal"),f(e),window.history.replaceState(null,null,t)}}catch{}$("#header #switch").on("click",t=>$("#header").toggleClass("show-nav")),$("#header #navigator").on("click",t=>$("#header").removeClass("show-nav")),$("#header #navigator > .inner").on("click",t=>t.stopPropagation()),$(".modal-overflow").on("click",t=>g()),$(".image-input .preview").on("click",t=>t.target.closest(".image-input").querySelector(".form-control").click()),$(".image-input > .form-control").on("change",t=>{const e=t.target.closest(".image-input").querySelector(".preview");if(t.target.files){const o=t.target.files[0];o&&(o.name.match(/\.(jpg|jpeg|png)$/)?e.src=URL.createObjectURL(o):alert("Не поддерживаемый тип файла!"))}}),$("[a-linked]").on("click",t=>{t.stopPropagation();const e=t.target.closest("[a-linked]").getAttribute("a-linked");t.target.hasAttribute("a-blank")?window.open(e):window.location.assign(e)}),$("button[type~='submit']").on("click",t=>{var l;t.preventDefault(),t.stopPropagation();const e=t.target.closest("form"),o=((l=e.getAttribute("method"))==null?void 0:l.toUpperCase())??"GET";return["GET","POST"].includes(o)?(e.submit(),!1):(e.dispatchEvent(new CustomEvent("custom-submit",{detail:{action:t.target.getAttribute("action")}})),!1)});function n(t){var o;t.stopPropagation();var e=((o=t.target.getAttribute("method"))==null?void 0:o.toUpperCase())??"GET";return["GET","POST","POSTM","DELETE","PUT"].includes(e)?e=="GET"||e=="POST"?!0:(e=="POSTM"&&(e="POST"),t.preventDefault(),async function(){var m;const l=t.target.getAttribute("action")??window.location.pathname,p=t.target.getAttribute("enctype")=="multipart/form-data",h=(m=t.detail)==null?void 0:m.action,w=p?new FormData(t.target):new URLSearchParams(Object.fromEntries(new FormData(t.target).entries())),d=await fetch(l,{method:e,headers:{"X-CSRF-TOKEN":s.admin_csrf_token??"none","X-ACTION":h??"default"},mode:"same-origin",referrerPolicy:"same-origin",body:w});if(d.headers.get("Content-Type")!=="application/json")return window.location.reload();const c=await d.json();if(c==null)return;let a=c.redirect;const b=c.reload,r=c.modal;if(a)return r&&(a=new URL(a.startsWith("http")?a:window.location.origin+a),a.searchParams.set("modal",JSON.stringify(r))),window.location.assign(a);if(b===!0&&r){const u=new URL(window.location.href);return u.searchParams.set("modal",JSON.stringify(r)),window.location.assign(u)}else if(r)return f(r);window.location.reload()}(),!1):(console.log("Form unknown method:",e),t.preventDefault(),!1)}$("form").on("submit",n),$("form").on("custom-submit",n)});
